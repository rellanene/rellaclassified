{% extends "base.html" %}
{% block title %}Edit Ad{% endblock %}

{% block content %}

<style>
    .edit-form input,
    .edit-form select,
    .edit-form textarea {
        width: 100%;
        padding: 12px;
        font-size: 15px;
        border-radius: 8px;
        border: 1px solid #4A3F5F;
        box-sizing: border-box;
    }

    .edit-form textarea {
        resize: vertical;
    }
</style>

<div style="min-height:100vh;background:#FAF3E0;padding:40px;">

<div style="
    max-width:600px;
    margin:auto;
    background:white;
    padding:40px;
    border-radius:16px;
    box-shadow:0 12px 30px rgba(0,0,0,.12);
">

<h2 style="text-align:center;color:#6C5B7B;margin-bottom:30px;">Edit Ad</h2>

<form method="POST" class="edit-form" style="display:flex;flex-direction:column;gap:18px;">


<label>Title</label>
<input name="title" value="{{ ad.title }}" required>

<label>Category</label>
<select name="category_id" required>
{% for c in categories %}
<option value="{{ c.id }}" {% if c.id == ad.category_id %}selected{% endif %}>
{{ c.name }}
</option>
{% endfor %}
</select>

<label>Province</label>
<select name="province_id" id="province" required>
{% for p in provinces %}
<option value="{{ p.id }}" {% if p.name == ad.province %}selected{% endif %}>
{{ p.name }}
</option>
{% endfor %}
</select>

<label>Town</label>
<select name="town_id" id="town" required>
{% for t in towns %}
<option value="{{ t.id }}" {% if t.name == ad.town %}selected{% endif %}>
{{ t.name }}
</option>
{% endfor %}
</select>

<label>Description</label>
<textarea name="description" rows="5" required>{{ ad.description }}</textarea>

<label>Contact</label>
<input name="contact" value="{{ ad.contact }}" required>

<label>Expires On</label>
<input
    type="date"
    name="expires_at"
    value="{{ ad.expires_at }}"
    min="{{ today }}"
    required
>

<button style="
    padding:14px;
    background:#C06C84;
    color:white;
    border:none;
    border-radius:8px;
    font-weight:bold;
">
Update Ad
</button>

</form>
</div>
</div>

<!-- AJAX town loader -->
<script>
document.getElementById("province").addEventListener("change", function () {
    fetch("/get_towns/" + this.value)
        .then(res => res.json())
        .then(data => {
            const town = document.getElementById("town");
            town.innerHTML = "<option value=''>Select Town</option>";
            data.forEach(t => {
                town.innerHTML += `<option value="${t.id}">${t.name}</option>`;
            });
        });
});
</script>
{% endblock %}
